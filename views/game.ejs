<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= state.gameTitle || 'Word Game' %></title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: linear-gradient(to bottom, #004c99, #66b3ff);
      color: white;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background: #00264d;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    .word-display {
      font-size: 36px;
      margin: 20px 0;
      line-height: 2;
    }
    .guesser {
      font-size: 14px;
      color: #ccc;
    }
    .guess-box {
      margin: 20px 0;
    }
    button {
      background-color: #0066cc;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #004080;
    }
    .card {
      background: #004080;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      color: white;
      text-align: left;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
    .players-container {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .last-guess-card {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 250px;
    }
    .winner {
      font-size: 40px;
      font-weight: bold;
      color: gold;
    }
    .loser {
      font-size: 20px;
      color: #bbb;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><%= state.gameTitle || 'Word Game' %></h1>

    <% if (state.currentState === 'WAITING_FOR_PLAYERS') { %>
      <div class="game-controls">
        <input type="text" id="game-title" placeholder="Set Game Title">
        <input type="text" id="game-word" placeholder="Add Word">
        <button onclick="setGameTitle()">Set Title</button>
        <button onclick="addWord()">Add Word</button>
        <button onclick="startGame()">Start Game</button>
      </div>
    <% } %>

    <% if (state.currentState === 'GAME_IN_PROGRESS') { %>
        <div class="word-display">
            <% state.words.forEach((word) => { %>
              <div>
                <% const guessedWord = state.guessedWords.find(gw => gw.word === word); %>
                <%= guessedWord ? word : word.charAt(0) + '_'.repeat(word.length - 1) %>
                <% if (guessedWord) { %>
                  <span class="guesser">(<%= guessedWord.guesser %>)</span>
                <% } %>
              </div>
            <% }); %>
          </div>
      <div class="guess-box">
        <input type="text" id="guess-word" placeholder="Your Guess" onkeypress="handleEnter(event)">
        <button onclick="submitGuess()">Submit Guess</button>
      </div>
    <% } %>

    <% if (state.currentState === 'GAME_COMPLETED') { %>
      <h2>Game Over!</h2>
      <% const winner = state.players.reduce((a, b) => a.score > b.score ? a : b); %>
      <div class="winner">Winner: <%= winner.displayName %> (Score: <%= winner.score %>)</div>
      <h3>Other Players:</h3>
      <% state.players.filter(p => p.id !== winner.id).forEach(player => { %>
        <div class="loser"><%= player.displayName %>: <%= player.score %></div>
      <% }); %>
    <% } %>

    <div class="players-container">
        <% state.players.forEach(player => { %>
          <div class="card">
            <strong><%= player.displayName %></strong><br>
            Score: <%= player.score %>
          </div>
        <% }); %>
      </div>
  
      <% if (state.lastPlayed) { %>
        <div class="card last-guess-card">
          <h3>Last Guess</h3>
          <p>
            <strong>Player:</strong> <%= state.lastPlayed.displayName %><br>
            <strong>Guess:</strong> <%= state.lastPlayed.guessedWord %><br>
            <strong>Result:</strong> <%= state.lastPlayed.correct ? 'Correct' : 'Incorrect' %>
          </p>
        </div>
      <% } %>
    </div>
  
    <script>
      const gameId = new URL(window.location.href).pathname.split('/').pop();
      const playerName = new URLSearchParams(window.location.search).get('playerName');

      function xhrRequest(endpoint, method, data) {
        fetch(`/${gameId}${endpoint}`, {
          method: method,
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }).then(res => res.json()).then(() => window.location.reload());
      }

      function setGameTitle() {
        const title = document.getElementById('game-title').value;
        xhrRequest('/game-title', 'POST', { title });
      }

      function addWord() {
        const word = document.getElementById('game-word').value;
        xhrRequest('/words', 'POST', { word });
      }

      function startGame() {
        xhrRequest('/start', 'POST', {});
      }

      function handleEnter(event) {
        if (event.key === 'Enter') {
            submitGuess();
        }
      }

      function submitGuess() {
        const guessedWord = document.getElementById('guess-word').value;

  fetch(`/${gameId}/guess`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      playerId: playerName, // Assuming playerName holds the player ID
      guessedWord
    })
  })
  .then(res => {
    if (!res.ok) {
      throw new Error('Failed to submit guess');
    }
    return res.json();
  })
  .then(data => {
    console.log('Guess submitted successfully', data);
    window.location.reload(); // Refresh the game state
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error submitting guess: ' + error.message);
  });
}

    </script>
  </div>
</body>
</html>
