<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= state.gameTitle || 'Word Game' %></title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: linear-gradient(to bottom, #004c99, #66b3ff);
      color: white;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background: #00264d;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    .guess-box {
      margin: 20px 0;
    }
    .word-display {
      font-size: 36px;
      margin: 20px 0;
    }
    .player {
      margin: 10px 0;
    }
    button {
      background-color: #0066cc;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #004080;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><%= state.gameTitle || 'Word Game' %></h1>
    <h2>Current Game State: <%= state.currentState %></h2>

    <% if (state.currentState === 'GAME_IN_PROGRESS') { %>
        <div class="word-display">
            <% if (state.words && state.words.length > 0) { %>
              <% state.words.forEach((word, index) => { %>
                <% if (index < state.currentWordIndex) { %>
                  <span><%= word %> </span>
                <% } else if (index === state.currentWordIndex) { %>
                  <span><%= word.charAt(0) + '_'.repeat(word.length - 1) %> </span>
                <% } else { %>
                  <span>_ </span>
                <% } %>
              <% }); %>
            <% } else { %>
              <span>No words available.</span>
            <% } %>
          </div>          
      <div class="guess-box">
        <input type="text" id="guess-word" placeholder="Your Guess">
        <button onclick="submitGuess()">Submit Guess</button>
      </div>
    <% } %>

    <% if (state.currentState === 'WAITING_FOR_PLAYERS') { %>
      <div class="game-controls">
        <input type="text" id="game-title" placeholder="Set Game Title">
        <input type="text" id="game-word" placeholder="Add Word">
        <button onclick="setGameTitle()">Set Title</button>
        <button onclick="addWord()">Add Word</button>
        <button onclick="startGame()">Start Game</button>
      </div>
    <% } %>

    <h3>Players</h3>
    <ul>
      <% state.players.forEach(player => { %>
        <li class="player">
          <strong><%= player.displayName %></strong> - Score: <%= player.score %>
        </li>
      <% }); %>
    </ul>

    <% if (state.lastPlayed) { %>
      <h3>Last Played:</h3>
      <p>
        <strong>Player:</strong> <%= state.lastPlayed.displayName %> <br>
        <strong>Guess:</strong> <%= state.lastPlayed.guessedWord %> <br>
        <strong>Result:</strong> <%= state.lastPlayed.correct ? 'Correct' : 'Incorrect' %>
      </p>
    <% } %>
  </div>

  <script>
    function xhrRequest(endpoint, method, data) {
      fetch(endpoint, {
        method: method,
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      }).then(res => res.json()).then(data => window.location.reload());
    }

    function setGameTitle() {
      const title = document.getElementById('game-title').value;
      xhrRequest('/game-title', 'POST', { title });
    }

    function addWord() {
      const word = document.getElementById('game-word').value;
      xhrRequest('/words', 'POST', { word });
    }

    function startGame() {
      xhrRequest('/start', 'POST', {});
    }

    function submitGuess() {
      const guessedWord = document.getElementById('guess-word').value;
      const playerName = new URLSearchParams(window.location.search).get('playerName');
      fetch('/players', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ displayName: playerName })
      }).then(res => res.json()).then(player => {
        xhrRequest('/guess', 'POST', {
          playerId: player.id, guessedWord
        });
      });
    }
  </script>
</body>
</html>